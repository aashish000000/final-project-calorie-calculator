(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[346],{5017:function(e,t,s){Promise.resolve().then(s.bind(s,2319))},2319:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var a=s(7437),r=s(2265),n=s(9376),i=s(9827),o=s(1713),l=s(1770),d=s(9501),c=s(3590),u=s(3180),m=s(9116),h=s(1384),g=s(7996),x=s(7648);function y(e){let{isOpen:t,onClose:s,onSuccess:n}=e,[o,d]=(0,r.useState)(null),[c,h]=(0,r.useState)(null),[x,y]=(0,r.useState)([]),[f,p]=(0,r.useState)(new Set),[b,j]=(0,r.useState)("upload"),N=(0,r.useRef)(null),v=(0,r.useRef)(null),w=(0,i.NL)(),P=(0,l.D)({mutationFn:e=>m.h.analyzeFood(e),onSuccess:e=>{y(e.foods),p(new Set(e.foods.map((e,t)=>t))),j("results")},onError:e=>{alert(e.message||"Failed to analyze image"),j("upload")}}),q=(0,l.D)({mutationFn:async e=>{let t=await m.h.getFoods(),s=(0,u.WU)(new Date,"yyyy-MM-dd");for(let a of e){let e=t.find(e=>e.name.toLowerCase()===a.name.toLowerCase());if(e)await m.h.createEntry({foodId:e.id,grams:a.estimatedGrams,date:s});else{let e=await m.h.createFood({name:a.name,caloriesPer100g:a.estimatedCalories/a.estimatedGrams*100,proteinPer100g:a.estimatedProtein/a.estimatedGrams*100,carbsPer100g:a.estimatedCarbs/a.estimatedGrams*100,fatPer100g:a.estimatedFat/a.estimatedGrams*100});await m.h.createEntry({foodId:e.id,grams:a.estimatedGrams,date:s})}}},onSuccess:()=>{w.invalidateQueries({queryKey:["entries"]}),w.invalidateQueries({queryKey:["metrics"]}),w.invalidateQueries({queryKey:["foods"]}),n(),T()}}),F=e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s){if(!s.type.startsWith("image/")){alert("Please select an image file");return}if(s.size>20971520){alert("Image size must be less than 20MB");return}d(s);let e=new FileReader;e.onloadend=()=>{h(e.result)},e.readAsDataURL(s)}},S=e=>{let t=new Set(f);t.has(e)?t.delete(e):t.add(e),p(t)},T=()=>{d(null),h(null),y([]),p(new Set),j("upload"),s()};return t?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"\uD83D\uDCF8 Food Photo Recognition"}),(0,a.jsx)("button",{onClick:T,className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,a.jsx)(g.q5L,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"p-6",children:["upload"===b&&(0,a.jsx)("div",{className:"space-y-4",children:c?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("img",{src:c,alt:"Food preview",className:"w-full h-64 object-contain bg-gray-100 rounded-lg"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>{o&&(j("analyzing"),P.mutate(o))},className:"flex-1 btn btn-primary",disabled:P.isPending,children:P.isPending?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.dAq,{className:"w-5 h-5 animate-spin"}),"Analyzing..."]}):"Analyze Food"}),(0,a.jsx)("button",{onClick:()=>{d(null),h(null)},className:"btn btn-secondary",children:"Choose Different Photo"})]})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-gray-600 text-center",children:"Take a photo or upload an image of your food, and AI will identify it and estimate nutrition info!"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("button",{onClick:()=>{var e;return null===(e=v.current)||void 0===e?void 0:e.click()},className:"flex flex-col items-center justify-center gap-3 p-8 border-2 border-dashed border-gray-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition",children:[(0,a.jsx)(g.tBf,{className:"w-12 h-12 text-indigo-600"}),(0,a.jsx)("span",{className:"font-medium",children:"Take Photo"})]}),(0,a.jsxs)("button",{onClick:()=>{var e;return null===(e=N.current)||void 0===e?void 0:e.click()},className:"flex flex-col items-center justify-center gap-3 p-8 border-2 border-dashed border-gray-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition",children:[(0,a.jsx)(g.Yjd,{className:"w-12 h-12 text-indigo-600"}),(0,a.jsx)("span",{className:"font-medium",children:"Upload Photo"})]})]}),(0,a.jsx)("input",{ref:N,type:"file",accept:"image/*",className:"hidden",onChange:F}),(0,a.jsx)("input",{ref:v,type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:F})]})}),"analyzing"===b&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[(0,a.jsx)(g.dAq,{className:"w-16 h-16 text-indigo-600 animate-spin"}),(0,a.jsx)("p",{className:"text-lg font-medium",children:"Analyzing your food..."}),(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:"This may take a few seconds"})]}),"results"===b&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-semibold",children:"Recognized Foods:"}),(0,a.jsx)("button",{onClick:()=>{j("upload"),d(null),h(null),y([])},className:"text-sm text-indigo-600 hover:underline",children:"Try Another Photo"})]}),c&&(0,a.jsx)("img",{src:c,alt:"Analyzed food",className:"w-full h-48 object-contain bg-gray-100 rounded-lg"}),(0,a.jsx)("div",{className:"space-y-2",children:x.map((e,t)=>(0,a.jsx)("div",{className:"p-4 border rounded-lg cursor-pointer transition ".concat(f.has(t)?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-gray-300"),onClick:()=>S(t),children:(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-5 h-5 rounded border-2 flex items-center justify-center ".concat(f.has(t)?"bg-indigo-600 border-indigo-600":"border-gray-300"),children:f.has(t)&&(0,a.jsx)(g.UgA,{className:"w-3 h-3 text-white"})}),(0,a.jsx)("h4",{className:"font-semibold",children:e.name})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[e.estimatedGrams,"g â€¢ ",e.estimatedCalories.toFixed(0)," cal"]}),(0,a.jsxs)("div",{className:"flex gap-4 text-xs text-gray-500 mt-2",children:[(0,a.jsxs)("span",{children:["P: ",e.estimatedProtein.toFixed(1),"g"]}),(0,a.jsxs)("span",{children:["C: ",e.estimatedCarbs.toFixed(1),"g"]}),(0,a.jsxs)("span",{children:["F: ",e.estimatedFat.toFixed(1),"g"]})]}),e.notes&&(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2 italic",children:e.notes})]})})},t))}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)("button",{onClick:()=>{let e=x.filter((e,t)=>f.has(t));if(0===e.length){alert("Please select at least one food item");return}q.mutate(e)},className:"flex-1 btn btn-primary",disabled:0===f.size||q.isPending,children:q.isPending?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.dAq,{className:"w-5 h-5 animate-spin"}),"Adding to Log..."]}):"Add ".concat(f.size," Item").concat(1!==f.size?"s":""," to Log")}),(0,a.jsx)("button",{onClick:T,className:"btn btn-secondary",children:"Cancel"})]})]})]})]})}):null}function f(){let e=(0,n.useRouter)(),t=(0,i.NL)(),[s]=(0,r.useState)((0,u.WU)(new Date,"yyyy-MM-dd")),[f,p]=(0,r.useState)(""),[b,j]=(0,r.useState)(!1),{data:N,isLoading:v}=(0,o.a)({queryKey:["foods"],queryFn:()=>m.h.getFoods()}),w=(0,l.D)({mutationFn:e=>m.h.createEntry({...e,date:s}),onSuccess:()=>{t.invalidateQueries({queryKey:["metrics"]}),t.invalidateQueries({queryKey:["entries"]}),p("Entry logged successfully!"),S(),setTimeout(()=>p(""),3e3)}}),{register:P,handleSubmit:q,watch:F,reset:S,formState:{errors:T}}=(0,d.cI)({resolver:(0,c.F)(h.r),defaultValues:{foodId:0,grams:100}}),E=F("foodId"),C=F("grams"),k=null==N?void 0:N.find(e=>e.id===Number(E)),O=(()=>{if(!k||!C)return null;let e=C/100;return{calories:(k.caloriesPer100g*e).toFixed(1),protein:(k.proteinPer100g*e).toFixed(1),carbs:(k.carbsPer100g*e).toFixed(1),fat:(k.fatPer100g*e).toFixed(1)}})();return(0,a.jsxs)("div",{className:"max-w-2xl mx-auto space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(x.default,{href:"/",className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,a.jsx)(g.Ao2,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Log Meal"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Record what you ate"})]})]}),(0,a.jsxs)("button",{onClick:()=>j(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition",children:[(0,a.jsx)(g.tBf,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Scan Food"})]})]}),f&&(0,a.jsxs)("div",{className:"flex items-center gap-2 p-4 bg-green-50 border border-green-200 text-green-700 rounded-lg",children:[(0,a.jsx)(g.UgA,{className:"w-5 h-5"}),f]}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("form",{onSubmit:q(e=>{w.mutate(e)}),className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Select Food"}),v?(0,a.jsx)("div",{className:"input bg-gray-100 animate-pulse h-10"}):(0,a.jsxs)("select",{...P("foodId"),className:"input ".concat(T.foodId?"input-error":""),children:[(0,a.jsx)("option",{value:0,children:"Choose a food..."}),null==N?void 0:N.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (",e.caloriesPer100g," cal/100g)"]},e.id))]}),T.foodId&&(0,a.jsx)("p",{className:"error-text",children:T.foodId.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Amount (grams)"}),(0,a.jsx)("input",{type:"number",...P("grams"),className:"input ".concat(T.grams?"input-error":""),placeholder:"100"}),T.grams&&(0,a.jsx)("p",{className:"error-text",children:T.grams.message})]}),O&&(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"Nutrition Preview"}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4 text-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:O.calories}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Calories"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:[O.protein,"g"]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Protein"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-2xl font-bold text-yellow-600",children:[O.carbs,"g"]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Carbs"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-2xl font-bold text-red-600",children:[O.fat,"g"]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Fat"})]})]})]}),(0,a.jsx)("button",{type:"submit",className:"btn btn-primary w-full",disabled:w.isPending,children:w.isPending?"Logging...":"Log Entry"})]})}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("button",{onClick:()=>e.push("/"),className:"btn btn-secondary flex-1",children:"View Dashboard"}),(0,a.jsx)(x.default,{href:"/foods",className:"btn btn-secondary flex-1 text-center",children:"Manage Foods"})]}),(0,a.jsx)(y,{isOpen:b,onClose:()=>j(!1),onSuccess:()=>{p("Foods added from photo successfully!"),setTimeout(()=>p(""),3e3)}})]})}},9116:function(e,t,s){"use strict";s.d(t,{h:function(){return i}});var a=s(4131);let r=s(257).env.NEXT_PUBLIC_API_URL||"http://localhost:5000/api";class n{getToken(){return a.Z.get("token")}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.getToken(),a={"Content-Type":"application/json",...s&&{Authorization:"Bearer ".concat(s)},...t.headers},n=await fetch("".concat(r).concat(e),{...t,headers:a,credentials:"include"});if(!n.ok)throw Error((await n.json().catch(()=>({}))).message||"HTTP error! status: ".concat(n.status));return 204===n.status?{}:n.json()}async register(e){return this.request("/auth/register",{method:"POST",body:JSON.stringify(e)})}async login(e,t){return this.request("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})})}async getCurrentUser(){return this.request("/auth/me")}async getFoods(){return this.request("/foods")}async getFood(e){return this.request("/foods/".concat(e))}async createFood(e){return this.request("/foods",{method:"POST",body:JSON.stringify(e)})}async updateFood(e,t){return this.request("/foods/".concat(e),{method:"PUT",body:JSON.stringify(t)})}async deleteFood(e){return this.request("/foods/".concat(e),{method:"DELETE"})}async getEntries(e){return this.request("/food-entries".concat(e?"?date=".concat(e):""))}async createEntry(e){return this.request("/food-entries",{method:"POST",body:JSON.stringify(e)})}async updateEntry(e,t){return this.request("/food-entries/".concat(e),{method:"PUT",body:JSON.stringify(t)})}async deleteEntry(e){return this.request("/food-entries/".concat(e),{method:"DELETE"})}async getDailyMetrics(e){return this.request("/metrics/daily".concat(e?"?date=".concat(e):""))}async getRangeMetrics(e,t){return this.request("/metrics/range?from=".concat(e,"&to=").concat(t))}async sendChatMessage(e,t){let s=null==t?void 0:t.map(e=>({sender:e.role,text:e.content}));return this.request("/chat",{method:"POST",body:JSON.stringify({message:e,history:s})})}async getGoals(){return this.request("/auth/goals")}async updateGoals(e){return this.request("/auth/goals",{method:"PUT",body:JSON.stringify(e)})}async updateProfile(e){return this.request("/auth/profile",{method:"PUT",body:JSON.stringify(e)})}async changePassword(e,t){return this.request("/auth/change-password",{method:"PUT",body:JSON.stringify({currentPassword:e,newPassword:t})})}async deleteAccount(){return this.request("/auth/account",{method:"DELETE"})}async uploadProfilePicture(e){return this.request("/auth/profile-picture",{method:"POST",body:JSON.stringify({imageData:e})})}async removeProfilePicture(){return this.request("/auth/profile-picture",{method:"DELETE"})}async analyzeFood(e){let t=new FormData;t.append("image",e);let s=this.getToken(),a=await fetch("".concat(r,"/image-recognition/analyze"),{method:"POST",headers:{...s&&{Authorization:"Bearer ".concat(s)}},body:t,credentials:"include"});if(!a.ok)throw Error((await a.json().catch(()=>({}))).message||"HTTP error! status: ".concat(a.status));return a.json()}async analyzeRecipe(e,t){return this.request("/recipe/analyze",{method:"POST",body:JSON.stringify({recipeText:e,servings:t})})}async getWaterSummary(e){return this.request("/water/summary".concat(e?"?date=".concat(e):""))}async logWater(e,t){return this.request("/water/log",{method:"POST",body:JSON.stringify({milliliters:e,date:t})})}async deleteWaterEntry(e){return this.request("/water/".concat(e),{method:"DELETE"})}async getFavoriteMeals(){return this.request("/favorite-meals")}async createFavoriteMeal(e){return this.request("/favorite-meals",{method:"POST",body:JSON.stringify(e)})}async deleteFavoriteMeal(e){return this.request("/favorite-meals/".concat(e),{method:"DELETE"})}async getFavoriteMealItems(e){return this.request("/favorite-meals/".concat(e,"/items"))}async getFoodSuggestions(e){return this.request("/suggestions".concat(e?"?date=".concat(e):""))}}let i=new n},1384:function(e,t,s){"use strict";s.d(t,{AY:function(){return i},dm:function(){return r},gY:function(){return n},r:function(){return o}});var a=s(7119);let r=a.Ry({email:a.Z_().email("Please enter a valid email"),password:a.Z_().min(1,"Password is required")}),n=a.Ry({firstName:a.Z_().min(1,"First name is required").max(100),middleName:a.Z_().max(100).optional(),lastName:a.Z_().min(1,"Last name is required").max(100),email:a.Z_().email("Please enter a valid email"),password:a.Z_().min(6,"Password must be at least 6 characters"),confirmPassword:a.Z_()}).refine(e=>e.password===e.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),i=a.Ry({name:a.Z_().min(1,"Name is required").max(255),caloriesPer100g:a.oQ.number().min(0).max(1e4),proteinPer100g:a.oQ.number().min(0).max(1e3),carbsPer100g:a.oQ.number().min(0).max(1e3),fatPer100g:a.oQ.number().min(0).max(1e3)}),o=a.Ry({foodId:a.oQ.number().min(1,"Please select a food"),grams:a.oQ.number().min(1,"Grams must be at least 1").max(1e4)})},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})}},function(e){e.O(0,[956,599,473,954,561,180,971,117,744],function(){return e(e.s=5017)}),_N_E=e.O()}]);